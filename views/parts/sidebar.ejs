<div class="sidebar group fixed left-0 top-0 h-full w-14 bg-gray-900 flex flex-col items-center py-4 overflow-y-auto overflow-x-hidden border-r border-gray-700 transition-all duration-200 hover:w-52">
  <div class="flex flex-col items-center gap-4 pt-4 w-full">
    <div class="server-item active w-full mx-auto p-2 rounded-md flex items-center hover:bg-gray-700 cursor-pointer group/item" onclick="window.location.href='/'">
      <img src="/others/pulse.png" alt="Server Icon" class="w-8 h-8 rounded-full mr-2" />
      <span class="text-gray-300 font-medium group-hover:opacity-100 transition-all duration-200 opacity-0 group-hover:w-auto w-0 text-ellipsis whitespace-nowrap">Home</span>
    </div>
    <div class="server-item w-full mx-auto p-2 rounded-md flex items-center hover:bg-gray-700 cursor-pointer group/item" onclick="window.location.href='/account'">
      <img src="<%= user.profilepicture %>" alt="User Profile" class="w-8 h-8 rounded-full mr-2" />
      <span class="text-gray-300 font-medium group-hover:opacity-100 transition-all duration-200 opacity-0 group-hover:w-auto w-0 text-ellipsis whitespace-nowrap">Account</span>
    </div>
    <div class="w-full h-px bg-gray-700 my-4"></div>

    <div class="server-item w-full mx-auto p-2 rounded-md flex items-center hover:bg-gray-700 cursor-pointer group/item" onclick="openGroupChatModal()">
      <span class="w-8 h-8 rounded-full flex items-center justify-center bg-gray-700 text-gray-300">
        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm-6 14c0-2 4-3.1 6-3.1s6 1.1 6 3.1v1H6v-1zm12-4h-2v-2h-2v2h-2v2h2v2h2v-2h2v-2z" fill="currentColor"/>
        </svg>
      </span>
      <span class="text-gray-300 font-medium ml-2 group-hover:opacity-100 transition-all duration-200 opacity-0 group-hover:w-auto w-0 text-ellipsis whitespace-nowrap">Create Group Chat</span>
    </div>

    <% if (typeof groupChats !== 'undefined' && groupChats.length > 0) { %>
      <div class="w-full h-px bg-gray-700 my-4"></div>
      <% groupChats.forEach(groupChat => { %>
        <div class="server-item w-full mx-auto p-2 rounded-md flex items-center hover:bg-gray-700 cursor-pointer group/item" onclick="window.location.href='/gc/<%= groupChat.id %>'">
          <span class="w-8 h-8 rounded-full mr-2 flex items-center justify-center bg-blue-700 text-white text-sm font-bold">GC</span>
          <span class="text-gray-300 font-medium group-hover:opacity-100 transition-all duration-200 opacity-0 group-hover:w-auto w-0 text-ellipsis whitespace-nowrap"><%= groupChat.name %></span>
        </div>
      <% }) %>
      <div class="w-full h-px bg-gray-700 my-4"></div>
    <% } %>

    <% if (user && user.friends && user.friends.length > 0) { %>
      <% user.friends.forEach(friendUsername => { %>
        <% const friend = users.find(u => u.username === friendUsername); %>
        <% if (friend) { %>
          <div class="server-item w-full mx-auto p-2 rounded-md flex items-center hover:bg-gray-700 cursor-pointer group/item" onclick="window.location.href='/dm/<%= friend.id %>'">
            <img src="<%= friend.profilepicture %>" alt="<%= friend.username %> Profile" class="w-8 h-8 rounded-full mr-2" />
            <span class="text-gray-300 font-medium group-hover:opacity-100 transition-all duration-200 opacity-0 group-hover:w-auto w-0 text-ellipsis whitespace-nowrap"><%= friend.username %></span>
          </div>
        <% } %>
      <% }) %>
    <% } %>
  </div>
</div>

<style>
  .sidebar::-webkit-scrollbar {
    width: 0px;
    transition: width 0.2s ease-in-out;
  }

  .sidebar:hover::-webkit-scrollbar {
    width: 8px;
  }

  .sidebar::-webkit-scrollbar-track {
    background: #2d3748;
  }

  .sidebar::-webkit-scrollbar-thumb {
    background: #4a5568;
    border-radius: 4px;
  }

  .sidebar::-webkit-scrollbar-thumb:hover {
    background: #718096;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const activeItem = document.querySelector('.server-item.active');
    if (activeItem) {
      document.querySelector('.sidebar').classList.add('expanded');
    }
  });
</script>